---
import { arrayCards } from '@/utils/data';
import { baseUrl } from '@/utils/functions';
---

<section class='am-container-cards'>
  {
    arrayCards.map(({ localImage, web, title }, i) => (
      <div
        class={`phce card card-${i}`}
        data-href={web}
        style={{ '--bg-image': `url(${baseUrl(localImage)})` }}
      >
        <div class='content'>{title}</div>
      </div>
    ))
  }
</section>

<style>
  .am-container-cards {
    min-height: 100vh;
    padding: 2.2vmax;
    gap: 2.2vmax;
    display: grid;
    position: relative;
    z-index: 100;
    place-items: center;
    place-content: center;
    grid-template-columns: repeat(auto-fit, minmax(17vmax, 1fr));

    .phce {
      perspective: 1000px;
      position: relative;

      &.card {
        min-width: 16vmax;
        aspect-ratio: 16 / 9;
        text-decoration: none;

        * {
          touch-action: auto;
        }
      }

      .content {
        position: relative;
        overflow: hidden;
        transform-style: preserve-3d;
        user-select: none;
        cursor: pointer;
        display: grid;
        place-items: center;
        border-radius: 1rem;
        padding: 1vmax;
        font-size: 1.1vmax;
        text-align: center;
        min-height: 12vmax;
        color: white;
        --bg-overlay: rgb(0 0 0 / 0.5);

        &::before,
        &::after {
          content: '';
          position: absolute;
          inset: 0;
          z-index: -1;
          transform-style: preserve-3d;
        }

        &::before {
          background-image: var(--bg-image);
          background-size: cover;
          background-position: center;
        }

        &::after {
          background: var(--bg-overlay, none);
        }
      }

      &:hover {
        > .content {
          transform: rotateX(calc(22.5deg * var(--posY, 0)))
            rotateY(calc(-22.5deg * var(--posX, 0)));

          &::before {
            transform: scale(1.33) translateX(calc(-12.5% * var(--posX, 0)))
              translateY(calc(-12.5% * var(--posY, 0)));
          }
        }
      }

      &:not(:hover) {
        > .content,
        > .content::before {
          transition: transform var(--transition-duration, 500ms)
            var(--transition-timing-function, linear);
        }
      }
    }
  }
</style>

<script>
 document.addEventListener('pointermove', e => {
  const el = document.elementFromPoint(e.clientX, e.clientY)?.closest<HTMLElement>('.phce')
  if (!el) return

  const rect = el.getBoundingClientRect()
  const x = e.clientX - rect.left
  const y = e.clientY - rect.top

  el.style.setProperty('--posX', map(x, [0, rect.width]).toString())
  el.style.setProperty('--posY', map(y, [0, rect.height]).toString())
})

document.addEventListener('click', e => {
  const el = document.elementFromPoint(e.clientX, e.clientY)?.closest<HTMLElement>('.phce')
  const href = el?.dataset.href
  if (href) window.location.href = href
})

const map = (
  value: number,
  [inMin, inMax]: [number, number],
  [outMin, outMax]: [number, number] = [-1, 1],
  decimals = 2
): number => {
  const mapped =
    ((value - inMin) * (outMax - outMin)) / (inMax - inMin) + outMin
  const clamped = Math.min(Math.max(mapped, outMin), outMax)
  const factor = 10 ** decimals
  return decimals > 0 ? Math.round(clamped * factor) / factor : clamped
}
</script>
